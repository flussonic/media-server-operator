apiVersion: v1
kind: Service
metadata:
  name: mediaserver
  namespace: catena-se
spec:
  ports:
  - port: 80
    targetPort: 80
    name: payload
  - port: 81
    targetPort: 81
    name: api
  selector:
    app.kubernetes.io/name: catena-se
    app.kubernetes.io/component: streamer
  internalTrafficPolicy: Local
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: central
  namespace: catena-se
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  rules:
    - host: catena.myhostname.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: central
                port:
                  number: 80
  tls:
  - hosts:
    - catena.myhostname.local
    secretName: central-cert
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: mediaserver
  namespace: catena-se
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod

    # This meant to be used to properly route traffik to each node
    traefik.ingress.kubernetes.io/service.nativelb: "true"
    nginx.ingress.kubernetes.io/service-upstream: 'true'
spec:
  rules:
    - host: s1.myhostname.local
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: mediaserver
                port:
                  number: 81
  tls:
  - hosts:
    - s1.myhostname.local
    secretName: mediaserver-cert
